<?xml version="1.0" encoding="utf-8"?>
<kiln:root xmlns:dir="http://apache.org/cocoon/directory/2.0"
  xmlns:kiln="http://www.kcl.ac.uk/artshums/depts/ddh/kiln/ns/1.0"
  xmlns:tei="http://www.tei-c.org/ns/1.0" xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <!-- Imports the default variables. -->
  <xsl:import href="cocoon://_internal/template/xsl/stylesheets/defaults.xsl" />

  <!-- Imports stylesheet to convert TEI into HTML. -->
  <xsl:import href="cocoon://_internal/template/xsl/stylesheets/tei/to-html.xsl" />

  <data>
    <title>
      <kiln:block name="title">
        <xsl:value-of
          select="/aggregation/tei:TEI/tei:teiHeader/tei:fileDesc/tei:titleStmt/tei:title[1]" />
      </kiln:block>
    </title>
    <metadata>
      <kiln:block name="metadata">
        <!-- $text is a sitemap parameter -->
        <texts current="{$text}">
          <xsl:for-each select="/aggregation/dir:directory/dir:file">
            <xsl:if test="not(contains($text, @name))">
              <text name="{parent::*/@name}/{@name}" />
            </xsl:if>
          </xsl:for-each>
        </texts>
      </kiln:block>
    </metadata>
    <content>
      <kiln:block name="content">
        <xsl:apply-templates select="/aggregation/tei:TEI/tei:text/tei:body" />
      </kiln:block>
    </content>
  </data>
</kiln:root>
