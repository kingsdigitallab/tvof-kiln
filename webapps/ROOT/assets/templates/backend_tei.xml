<?xml version="1.0" encoding="utf-8"?>
<kiln:root xmlns:dir="http://apache.org/cocoon/directory/2.0"
  xmlns:kiln="http://www.kcl.ac.uk/artshums/depts/ddh/kiln/ns/1.0"
  xmlns:tei="http://www.tei-c.org/ns/1.0" xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <!-- Imports the default variables. -->
  <xsl:import href="cocoon://_internal/template/xsl/stylesheets/defaults.xsl" />
  <!-- Imports stylesheet to convert TEI into HTML. -->
  <xsl:import href="cocoon://_internal/template/xsl/stylesheets/tei/to-html.xsl" />
  <data>
    <title>
      <kiln:block name="title">
        <xsl:choose>
          <xsl:when test="/aggregation/sec">
            <div class="row">
              <div class="large-6 columns">
                <h1>
                  <xsl:value-of
                    select="/aggregation/main/tei:TEI/tei:teiHeader/tei:fileDesc/tei:titleStmt/tei:title[1]"
                   />
                </h1>
              </div>
              <div class="large-6 columns">
                <h1>
                  <xsl:value-of
                    select="/aggregation/sec/tei:TEI/tei:teiHeader/tei:fileDesc/tei:titleStmt/tei:title[1]"
                   />
                </h1>
              </div>
            </div>
          </xsl:when>
          <xsl:otherwise>
            <h1>
              <xsl:value-of
                select="/aggregation/main/tei:TEI/tei:teiHeader/tei:fileDesc/tei:titleStmt/tei:title[1]"
               />
            </h1>
          </xsl:otherwise>
        </xsl:choose>
      </kiln:block>
    </title>

    <metadata>
      <kiln:block name="metadata">
        <!-- $text-main and $text-sec are sitemap parameters -->
        <texts current="{$text-main}" sec="{$text-sec}">
          <xsl:for-each select="/aggregation/dir:directory/dir:file">
            <xsl:if
              test="not(contains(@name, $text-main)) and (not($text-sec) or not(contains(@name, $text-sec)))">
              <text name="{substring-before(@name, '.xml')}" />
            </xsl:if>
          </xsl:for-each>
        </texts>
      </kiln:block>
    </metadata>

    <navigation>
      <kiln:block name="navigation">
        <!-- $text-main and $text-sec are sitemap parameters -->
        <xsl:choose>
          <xsl:when test="/aggregation/sec">
            <div class="row">
              <div class="large-6 columns">
                <ul class="dropdown menu" data-dropdown-menu="">
                  <li>
                    <a>Change text to</a>
                    <ul class="menu">
                      <xsl:for-each select="/aggregation/dir:directory/dir:file">
                        <xsl:if
                          test="not(contains(@name, $text-main)) and not(contains(@name, $text-sec))">
                          <xsl:variable name="name" select="substring-before(@name, '.xml')" />
                          <li>
                            <a href="../../{$name}/{$text-sec}/">
                              <xsl:value-of select="$name" />
                            </a>
                          </li>
                        </xsl:if>
                      </xsl:for-each>
                    </ul>
                  </li>
                </ul>
              </div>
              <div class="large-6 columns">
                <ul class="dropdown menu" data-dropdown-menu="">
                  <li>
                    <a>Change text to</a>
                    <ul class="menu">
                      <xsl:for-each select="/aggregation/dir:directory/dir:file">
                        <xsl:if
                          test="not(contains(@name, $text-main)) and not(contains(@name, $text-sec))">
                          <xsl:variable name="name" select="substring-before(@name, '.xml')" />
                          <li>
                            <a href="../{$name}/">
                              <xsl:value-of select="$name" />
                            </a>
                          </li>
                        </xsl:if>
                      </xsl:for-each>
                    </ul>
                  </li>
                </ul>
              </div>
            </div>
          </xsl:when>
          <xsl:otherwise>
            <ul class="dropdown menu" data-dropdown-menu="">
              <li>
                <a>Compare with</a>
                <ul class="menu">
                  <xsl:for-each select="/aggregation/dir:directory/dir:file">
                    <xsl:if test="not(contains(@name, $text-main))">
                      <xsl:variable name="name" select="substring-before(@name, '.xml')" />
                      <li>
                        <a href="{$name}/">
                          <xsl:value-of select="$name" />
                        </a>
                      </li>
                    </xsl:if>
                  </xsl:for-each>
                </ul>
              </li>
            </ul>
          </xsl:otherwise>
        </xsl:choose>
      </kiln:block>
    </navigation>

    <content>
      <kiln:block name="content">
        <xsl:choose>
          <xsl:when test="/aggregation/sec">
            <div class="row">
              <div class="large-6 columns">
                <xsl:apply-templates select="/aggregation/main/tei:TEI/tei:text/tei:body" />
              </div>
              <div class="large-6 columns">
                <xsl:apply-templates select="/aggregation/sec/tei:TEI/tei:text/tei:body" />
              </div>
            </div>
          </xsl:when>
          <xsl:otherwise>
            <xsl:apply-templates select="/aggregation/main/tei:TEI/tei:text/tei:body" />
          </xsl:otherwise>
        </xsl:choose>
      </kiln:block>
    </content>
  </data>
</kiln:root>
